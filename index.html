import React, { useState, useRef, useEffect } from 'react';
import { Sparkles, Heart, Zap, Anchor, ArrowRight, RefreshCcw, BookOpen, Star, Smile, Target, ChevronRight, Check, List, Award, TrendingUp, AlertTriangle, Bot, MessageSquare } from 'lucide-react';

// --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---

// 1. ã‚¿ã‚¤ãƒ—å®šç¾© (Archetypes)
const ARCHETYPES = {
  creator: {
    id: 'creator',
    name: "ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ï¼ˆå‰µé€ è€…ï¼‰",
    desc: "ã€Œ0ã‹ã‚‰1ã€ã‚’ç”Ÿã¿å‡ºã™ã“ã¨ã«é­‚ãŒéœ‡ãˆã‚‹ã‚¿ã‚¤ãƒ—ã€‚æ—¢å­˜ã®æ çµ„ã¿ã«å›šã‚ã‚Œãšã€è‡ªåˆ†ã®æ„Ÿæ€§ã‚„ã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å½¢ã«ã™ã‚‹ã“ã¨ã«æœ€å¤§ã®å–œã³ã‚’æ„Ÿã˜ã¾ã™ã€‚",
    strengths: ["ç‹¬å‰µçš„ãªç™ºæƒ³åŠ›", "ç¾æ„è­˜ãƒ»ã‚»ãƒ³ã‚¹", "æ²¡é ­ã™ã‚‹é›†ä¸­åŠ›", "å¤‰åŒ–ã¸ã®é©å¿œåŠ›"],
    weaknesses: ["å˜ç´”ä½œæ¥­ã®ç¹°ã‚Šè¿”ã—", "éåº¦ãªãƒ«ãƒ¼ãƒ«ãƒ»æŸç¸›", "èˆˆå‘³ã®ãªã„ã“ã¨ã¸ã®ç„¡é–¢å¿ƒ"],
    suitable_jobs: ["ä¼ç”»ãƒ»ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°", "ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°", "äº‹æ¥­é–‹ç™º", "ãƒ©ã‚¤ã‚¿ãƒ¼ãƒ»ç·¨é›†"],
    advice: "ã€Œä½•ã‚’ä½œã‚‹ã‹ã€ã¨åŒã˜ãã‚‰ã„ã€Œã©ã‚“ãªç’°å¢ƒã§ä½œã‚‹ã‹ã€ãŒé‡è¦ã§ã™ã€‚è£é‡æ¨©ãŒã‚ã‚Šã€æˆæœç‰©ã§è©•ä¾¡ã•ã‚Œã‚‹å ´æ‰€ã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚"
  },
  supporter: {
    id: 'supporter',
    name: "ã‚µãƒãƒ¼ã‚¿ãƒ¼ï¼ˆæ”¯æ´è€…ï¼‰",
    desc: "ã€Œèª°ã‹ã®ãŸã‚ã€ãŒåŸå‹•åŠ›ã«ãªã‚‹ã‚¿ã‚¤ãƒ—ã€‚çµ„ç¹”ã®æ½¤æ»‘æ²¹ã¨ãªã‚Šã€äººã€…ã®æˆé•·ã‚„å¹¸ç¦ã‚’æ”¯ãˆã‚‹ã“ã¨ã«æ·±ã„ã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ã¾ã™ã€‚",
    strengths: ["é«˜ã„å…±æ„ŸåŠ›", "èª¿æ•´ãƒ»äº¤æ¸‰åŠ›", "è‚²æˆãƒ»ã‚³ãƒ¼ãƒãƒ³ã‚°åŠ›", "ãƒªã‚¹ã‚¯ç®¡ç†èƒ½åŠ›"],
    weaknesses: ["æ®ºä¼ã¨ã—ãŸç«¶äº‰ç’°å¢ƒ", "äººé–“é–¢ä¿‚ã®å¯¾ç«‹", "æ„Ÿè¬ãŒæ„Ÿã˜ã‚‰ã‚Œãªã„ä»•äº‹"],
    suitable_jobs: ["äººäº‹ãƒ»æ¡ç”¨ãƒ»åŠ´å‹™", "ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µã‚¯ã‚»ã‚¹", "ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆ", "åŒ»ç™‚ãƒ»ç¦ç¥‰ãƒ»æ•™è‚²"],
    advice: "ã‚ãªãŸã®å¼·ã¿ã¯ã€Œå¯¾äººé–¢ä¿‚è³‡ç”£ã€ã‚’ç¯‰ãåŠ›ã§ã™ã€‚æ•°å­—ã ã‘ã§ãªãã€é¡§å®¢ã‚„ç¤¾å“¡ã®æº€è¶³åº¦ã‚’é‡è¦–ã™ã‚‹ä¼æ¥­æ–‡åŒ–ãŒãƒãƒƒãƒã—ã¾ã™ã€‚"
  },
  analyst: {
    id: 'analyst',
    name: "ã‚¢ãƒŠãƒªã‚¹ãƒˆï¼ˆæ¢ç©¶è€…ï¼‰",
    desc: "ã€Œãªãœï¼Ÿã€ã‚’çªãè©°ã‚ã€è§£ã‚’è¦‹ã¤ã‘ã‚‹ã‚¿ã‚¤ãƒ—ã€‚æ„Ÿæƒ…ã‚ˆã‚Šã‚‚è«–ç†ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’é‡è¦–ã—ã€è¤‡é›‘ãªå•é¡Œã‚’æ§‹é€ åŒ–ã—ã¦è§£æ±ºã™ã‚‹ã“ã¨ã«å¿«æ„Ÿã‚’è¦šãˆã¾ã™ã€‚",
    strengths: ["è«–ç†çš„æ€è€ƒåŠ›", "ãƒ‡ãƒ¼ã‚¿åˆ†æåŠ›", "å®¢è¦³çš„ãªè¦–ç‚¹", "å°‚é–€çŸ¥è­˜ã®ç¿’å¾—"],
    weaknesses: ["æ ¹æ€§è«–ã‚„æ„Ÿæƒ…çš„ãªæŒ‡ç¤º", "éåŠ¹ç‡ãªãƒ—ãƒ­ã‚»ã‚¹", "é »ç¹ãªå‰²ã‚Šè¾¼ã¿ä½œæ¥­"],
    suitable_jobs: ["ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ãƒ†ã‚£ã‚¹ãƒˆ", "ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢", "é‡‘èå°‚é–€è·", "çµŒå–¶ä¼ç”»ãƒ»æˆ¦ç•¥"],
    advice: "ã€Œå°‚é–€æ€§ã€ãŒæ­¦å™¨ã«ãªã‚Šã¾ã™ã€‚ã‚¸ã‚§ãƒãƒ©ãƒªã‚¹ãƒˆã‚ˆã‚Šã‚‚ã€ç‰¹å®šã®é ˜åŸŸã‚’æ·±æ˜ã‚Šã§ãã‚‹ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆã®é“ãŒã€ã‚­ãƒ£ãƒªã‚¢ã®å®‰å®šã¨é«˜å¹´åã«ç¹‹ãŒã‚Šã¾ã™ã€‚"
  },
  leader: {
    id: 'leader',
    name: "ãƒªãƒ¼ãƒ€ãƒ¼ï¼ˆå¤‰é©è€…ï¼‰",
    desc: "ã€Œç›®æ¨™é”æˆã€ã«å‘ã‘ã¦äººã€…ã‚’å°ãã‚¿ã‚¤ãƒ—ã€‚å›°é›£ãªå£ãŒé«˜ã„ã»ã©ç‡ƒãˆä¸ŠãŒã‚Šã€è²¬ä»»ã‚ã‚‹ç«‹å ´ã§å¤§ããªæ±ºæ–­ã‚’ä¸‹ã™ã“ã¨ã«å……å®Ÿæ„Ÿã‚’æ„Ÿã˜ã¾ã™ã€‚",
    strengths: ["æ„æ€æ±ºå®šåŠ›", "æ¨é€²ãƒ»å®Ÿè¡ŒåŠ›", "ãƒ“ã‚¸ãƒ§ãƒ³ã‚’èªã‚‹åŠ›", "é€†å¢ƒã¸ã®å¼·ã•"],
    weaknesses: ["è£é‡æ¨©ã®ãªã„ä»•äº‹", "å¹´åŠŸåºåˆ—ã§é…ã„ã‚¹ãƒ”ãƒ¼ãƒ‰æ„Ÿ", "ç¾çŠ¶ç¶­æŒã®æ–‡åŒ–"],
    suitable_jobs: ["ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼", "çµŒå–¶å¹¹éƒ¨å€™è£œ", "èµ·æ¥­å®¶", "ã‚»ãƒ¼ãƒ«ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼"],
    advice: "ã€Œçµæœã€ã‚’å‡ºã›ã‚‹ç’°å¢ƒã«èº«ã‚’ç½®ãã¾ã—ã‚‡ã†ã€‚ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã‚„å¤–è³‡ç³»ãªã©ã€å®ŸåŠ›ä¸»ç¾©ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã“ãã€ã‚ãªãŸã®çœŸä¾¡ãŒç™ºæ®ã•ã‚Œã¾ã™ã€‚"
  }
};

// 2. è³ªå•ãƒ‡ãƒ¼ã‚¿

// Phase 1: åŸºç¤è¨ºæ–­ (å…¨ã‚¿ã‚¤ãƒ—å…±é€š) - 10å•
const QUESTIONS_PHASE_1 = [
  { id: 'p1_1', text: "ä¼‘æ—¥ã«äºˆå®šãŒæ€¥ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«ãªã‚Šã¾ã—ãŸã€‚ã½ã£ã‹ã‚Šç©ºã„ãŸæ™‚é–“ã€ã‚ãªãŸãªã‚‰ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ", options: [
    { label: "æ°—ã«ãªã£ã¦ã„ãŸæ–°ã—ã„ãŠåº—ã‚„å ´æ‰€ã«è¡Œã£ã¦ã¿ã‚‹", type: 'creator', score: 3 },
    { label: "å‹äººã«é€£çµ¡ã—ãŸã‚Šã€èª°ã‹ã¨ä¼šã†ç´„æŸã‚’å–ã‚Šä»˜ã‘ã‚‹", type: 'supporter', score: 3 },
    { label: "æºœã¾ã£ã¦ã„ãŸæœ¬ã‚’èª­ã‚“ã ã‚Šã€çŸ¥è­˜ã®ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã‚’ã™ã‚‹", type: 'analyst', score: 3 },
    { label: "ä»Šå¾Œã®è¨ˆç”»ã‚’ç«‹ã¦ç›´ã—ãŸã‚Šã€ã‚¸ãƒ ã§ä½“ã‚’é›ãˆã‚‹", type: 'leader', score: 3 },
  ]},
  { id: 'p1_2', text: "ãƒãƒ¼ãƒ ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é€²ã‚ã‚‹æ™‚ã€ã‚ãªãŸãŒè‡ªç„¶ã¨å¼•ãå—ã‘ã¦ã—ã¾ã†å½¹å‰²ã¯ï¼Ÿ", options: [
    { label: "æ–¬æ–°ãªã‚¢ã‚¤ãƒ‡ã‚¢å‡ºã—ã‚„ã€ä¼ç”»ã®æ–¹å‘æ€§ã‚’æ±ºã‚ã‚‹", type: 'creator', score: 3 },
    { label: "ãƒ¡ãƒ³ãƒãƒ¼ã®æ„è¦‹ã‚’èãã€é›°å›²æ°—ã‚’è‰¯ãã™ã‚‹", type: 'supporter', score: 3 },
    { label: "é€²æ—ç®¡ç†ã‚„ã€ãƒªã‚¹ã‚¯ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹", type: 'analyst', score: 3 },
    { label: "æœ€çµ‚æ±ºå®šã‚’ä¸‹ã—ã€è²¬ä»»ã‚’æŒã£ã¦çš†ã‚’å¼•ã£å¼µã‚‹", type: 'leader', score: 3 },
  ]},
  { id: 'p1_3', text: "ã‚ãªãŸãŒä»•äº‹ã§ã€Œä¸€ç•ªã‚¹ãƒˆãƒ¬ã‚¹ã ã€ã¨æ„Ÿã˜ã‚‹ç¬é–“ã¯ï¼Ÿ", options: [
    { label: "å‰ä¾‹è¸è¥²ã°ã‹ã‚Šã§ã€æ–°ã—ã„ã“ã¨ãŒã§ããªã„æ™‚", type: 'creator', score: 3 },
    { label: "ã‚®ã‚¹ã‚®ã‚¹ã—ãŸé›°å›²æ°—ã§ã€èª°ã‚‚å”åŠ›ã—åˆã‚ãªã„æ™‚", type: 'supporter', score: 3 },
    { label: "æ ¹æ‹ ã®ãªã„æŒ‡ç¤ºã§ã€éåŠ¹ç‡ãªä½œæ¥­ã‚’ã•ã›ã‚‰ã‚Œã‚‹æ™‚", type: 'analyst', score: 3 },
    { label: "è‡ªåˆ†ã®è£é‡ã§æ±ºã‚ã‚‰ã‚Œãšã€æ‰¿èªå¾…ã¡ã°ã‹ã‚Šã®æ™‚", type: 'leader', score: 3 },
  ]},
  { id: 'p1_4', text: "å­ä¾›ã®é ƒã€å¤¢ä¸­ã«ãªã£ã¦ã„ãŸéŠã³ã¯ï¼Ÿ", options: [
    { label: "çµµã‚’æãã€å·¥ä½œã€ãƒ–ãƒ­ãƒƒã‚¯ä½œã‚Š", type: 'creator', score: 3 },
    { label: "ã”ã£ã“éŠã³ã€ç§˜å¯†åŸºåœ°ã§ã®ä¼šè©±", type: 'supporter', score: 3 },
    { label: "å›³é‘‘ã‚’èª­ã‚€ã€ãƒ‘ã‚ºãƒ«ã€è¦³å¯Ÿæ—¥è¨˜", type: 'analyst', score: 3 },
    { label: "ã‚¬ã‚­å¤§å°†çš„ãªéŠã³ã€ç«¶äº‰ã€æ¢æ¤œ", type: 'leader', score: 3 },
  ]},
  { id: 'p1_5', text: "å‹äººã‹ã‚‰ç›¸è«‡ã‚’å—ã‘ãŸæ™‚ã€ã©ã†å¯¾å¿œã™ã‚‹ã“ã¨ãŒå¤šã„ï¼Ÿ", options: [
    { label: "ã€Œã“ã‚“ãªè§£æ±ºç­–ã¯ã©ã†ï¼Ÿã€ã¨æ–°ã—ã„è¦–ç‚¹ã‚’ææ¡ˆã™ã‚‹", type: 'creator', score: 2 },
    { label: "ã¾ãšã¯ã˜ã£ãã‚Šè©±ã‚’èãã€å…±æ„Ÿã—ã¦ã‚ã’ã‚‹", type: 'supporter', score: 3 },
    { label: "çŠ¶æ³ã‚’æ•´ç†ã—ã€ä½•ãŒå•é¡Œã‹ã‚’åˆ†æã—ã¦ã‚ã’ã‚‹", type: 'analyst', score: 3 },
    { label: "ã€Œã“ã†ã™ã¹ãã ã€ã¨èƒŒä¸­ã‚’æŠ¼ã—ã¦ã‚ã’ã‚‹", type: 'leader', score: 2 },
  ]},
  { id: 'p1_6', text: "æ˜ ç”»ã‚„ãƒ‰ãƒ©ãƒã‚’è¦‹ã‚‹æ™‚ã€ã©ã“ã«æ³¨ç›®ã—ã¦ã—ã¾ã†ï¼Ÿ", options: [
    { label: "æ˜ åƒç¾ã€æ¼”å‡ºã€ç‹¬è‡ªã®ä¸–ç•Œè¦³", type: 'creator', score: 3 },
    { label: "ç™»å ´äººç‰©ã®å¿ƒæƒ…ã‚„äººé–“é–¢ä¿‚ã®å¤‰åŒ–", type: 'supporter', score: 3 },
    { label: "ä¼ç·šå›åã‚„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®è«–ç†çš„ãªæ§‹æˆ", type: 'analyst', score: 3 },
    { label: "ä¸»äººå…¬ã®æ±ºæ–­ã‚„ã€å›°é›£ã‚’ä¹—ã‚Šè¶Šãˆã‚‹å§¿", type: 'leader', score: 3 },
  ]},
  { id: 'p1_7', text: "ã€ŒæˆåŠŸã—ãŸã€ã¨æ„Ÿã˜ã‚‹ã®ã¯ã©ã‚“ãªæ™‚ï¼Ÿ", options: [
    { label: "è‡ªåˆ†ã«ã—ã‹ã§ããªã„è¡¨ç¾ãŒã§ããŸæ™‚", type: 'creator', score: 3 },
    { label: "é–¢ã‚ã£ãŸäººãŒç¬‘é¡”ã«ãªã‚Šã€æ„Ÿè¬ã•ã‚ŒãŸæ™‚", type: 'supporter', score: 3 },
    { label: "é›£è§£ãªèª²é¡Œã®ã€Œæ­£è§£ã€ã‚’å°ãå‡ºã›ãŸæ™‚", type: 'analyst', score: 3 },
    { label: "ç›®æ¨™æ•°å€¤ã‚’é”æˆã—ã€ç§°è³›ã•ã‚ŒãŸæ™‚", type: 'leader', score: 3 },
  ]},
  { id: 'p1_8', text: "ã“ã‚Œã ã‘ã¯è­²ã‚Œãªã„ã€ã‚ãªãŸã®ä¾¡å€¤è¦³ã¯ï¼Ÿ", options: [
    { label: "è‡ªç”±ãƒ»ã‚ªãƒªã‚¸ãƒŠãƒªãƒ†ã‚£", type: 'creator', score: 3 },
    { label: "èª å®Ÿãƒ»èª¿å’Œ", type: 'supporter', score: 3 },
    { label: "çœŸç†ãƒ»æ­£ç¢ºæ€§", type: 'analyst', score: 3 },
    { label: "é”æˆãƒ»å½±éŸ¿åŠ›", type: 'leader', score: 3 },
  ]},
  { id: 'p1_9', text: "ã‚‚ã—æ˜æ—¥ã‹ã‚‰1ãƒ¶æœˆä¼‘ã¿ãŒå–ã‚ŒãŸã‚‰ï¼Ÿ", options: [
    { label: "å‰µä½œæ´»å‹•ã‚„è¶£å‘³ã«æ²¡é ­ã™ã‚‹", type: 'creator', score: 3 },
    { label: "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ã‚„å®¶æ—ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã™ã‚‹", type: 'supporter', score: 3 },
    { label: "è³‡æ ¼ã®å‹‰å¼·ã‚„å°‚é–€æ›¸ã‚’èª­ã¿æ¼ã‚‹", type: 'analyst', score: 3 },
    { label: "èµ·æ¥­ã®æº–å‚™ã‚„ã€å¤§ããªæ—…è¡Œè¨ˆç”»ã‚’å®Ÿè¡Œã™ã‚‹", type: 'leader', score: 3 },
  ]},
  { id: 'p1_10', text: "ä»–äººã‹ã‚‰ã‚ˆãè¨€ã‚ã‚Œã‚‹è¤’ã‚è¨€è‘‰ã¯ï¼Ÿ", options: [
    { label: "ã€Œã‚»ãƒ³ã‚¹ãŒã„ã„ã­ã€ã€Œé¢ç™½ã„ç™ºæƒ³ã ã­ã€", type: 'creator', score: 3 },
    { label: "ã€Œè©±ã—ã‚„ã™ã„ã­ã€ã€Œå„ªã—ã„ã­ã€", type: 'supporter', score: 3 },
    { label: "ã€Œè©³ã—ã„ã­ã€ã€Œé ­ã®å›è»¢ãŒé€Ÿã„ã­ã€", type: 'analyst', score: 3 },
    { label: "ã€Œé ¼ã‚Šã«ãªã‚‹ã­ã€ã€Œæ±ºæ–­åŠ›ãŒã‚ã‚‹ã­ã€", type: 'leader', score: 3 },
  ]},
];

// Phase 2: ã‚¿ã‚¤ãƒ—åˆ¥æ·±æ˜ã‚Šè³ªå• (Phase 1ã®çµæœã§åˆ†å²)
const QUESTIONS_PHASE_2 = {
  creator: [
    { text: "ã‚¢ã‚¤ãƒ‡ã‚¢ãŒè¡Œãè©°ã¾ã£ãŸæ™‚ã€ã©ã†ã‚„ã£ã¦æ‰“é–‹ã—ã¾ã™ã‹ï¼Ÿ", options: [{ label: "å…¨ãé•ã†åˆ†é‡ã‹ã‚‰ãƒ’ãƒ³ãƒˆã‚’æ¢ã™", skill: "æ¨ªæ–­çš„æ€è€ƒåŠ›" }, { label: "æ‰‹ã‚’å‹•ã‹ã—ãªãŒã‚‰è€ƒãˆã‚‹", skill: "ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°åŠ›" }, { label: "ä¸€åº¦å¯ã‹ã›ã¦ç„¡æ„è­˜ã«ä»»ã›ã‚‹", skill: "ç›´æ„ŸåŠ›" }] },
    { text: "ã‚ãªãŸã®ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒæœ€ã‚‚ç™ºæ®ã•ã‚Œã‚‹ã®ã¯ï¼Ÿ", options: [{ label: "0ã‹ã‚‰1ã‚’ç”Ÿã¿å‡ºã™ä¼ç”»æ®µéš", skill: "0â†’1åŠ›" }, { label: "1ã‚’10ã«ã™ã‚‹æ”¹å–„ãƒ»ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—", skill: "æ”¹å–„ææ¡ˆåŠ›" }, { label: "ç•°ãªã‚‹ã‚‚ã®ã‚’çµ„ã¿åˆã‚ã›ã‚‹æ™‚", skill: "ç·¨é›†åŠ›" }] },
    { text: "ã“ã ã‚ã‚Šã™ãã¦ç´æœŸãŒå±ãªã„æ™‚ã€ã©ã†ã—ã¾ã™ã‹ï¼Ÿ", options: [{ label: "å“è³ªã‚’å„ªå…ˆã—ã€ç´æœŸäº¤æ¸‰ã‚’ã™ã‚‹", skill: "å“è³ªè¿½æ±‚åŠ›" }, { label: "è¦ä»¶ã‚’è¦‹ç›´ã—ã€æœ€ä½é™ã§ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹", skill: "æŸ”è»Ÿæ€§" }, { label: "è¶…é›†ä¸­ãƒ¢ãƒ¼ãƒ‰ã§ãªã‚“ã¨ã‹é–“ã«åˆã‚ã›ã‚‹", skill: "ç¬ç™ºåŠ›" }] },
    { text: "å¥½ããªã€Œä½œæ¥­ã€ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ", options: [{ label: "æ–‡ç« ã‚’æ›¸ããƒ»è¨€è‘‰ã‚’é¸ã¶", skill: "ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°" }, { label: "è‰²ã‚„é…ç½®ã‚’è€ƒãˆã‚‹", skill: "ãƒ‡ã‚¶ã‚¤ãƒ³æ€è€ƒ" }, { label: "ä»•çµ„ã¿ã‚„ãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ„ã‚€", skill: "æ§‹ç¯‰åŠ›" }] },
    { text: "ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãƒ¯ãƒ¼ã‚¯ï¼ˆå˜ç´”ä½œæ¥­ï¼‰ã¸ã®è€æ€§ã¯ï¼Ÿ", options: [{ label: "è‹¦ç—›ã§ä»•æ–¹ãŒãªã„", skill: "æ–°è¦æ€§å¿—å‘" }, { label: "å·¥å¤«ã—ã¦åŠ¹ç‡åŒ–ã™ã‚‹ãªã‚‰æ¥½ã—ã‚ã‚‹", skill: "æ¥­å‹™ãƒãƒƒã‚¯åŠ›" }, { label: "ç„¡å¿ƒã«ãªã‚Œã‚‹ã®ã§æ„å¤–ã¨å«Œã„ã˜ã‚ƒãªã„", skill: "é›†ä¸­æŒç¶šåŠ›" }] },
  ],
  supporter: [
    { text: "ãƒãƒ¼ãƒ å†…ã§æ„è¦‹ãŒå¯¾ç«‹ã—ã¾ã—ãŸã€‚ã©ã†å‹•ãã¾ã™ã‹ï¼Ÿ", options: [{ label: "åŒæ–¹ã®è©±ã‚’å€‹åˆ¥ã«èãã«è¡Œã", skill: "å‚¾è´ãƒ»èª¿æ•´åŠ›" }, { label: "å…±é€šã®ã‚´ãƒ¼ãƒ«ã‚’å†ç¢ºèªã•ã›ã‚‹", skill: "ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³" }, { label: "æŠ˜è¡·æ¡ˆã‚’æç¤ºã™ã‚‹", skill: "å•é¡Œè§£æ±ºåŠ›" }] },
    { text: "ã€Œèª°ã‹ã®å½¹ã«ç«‹ã£ãŸã€ã¨ä¸€ç•ªæ„Ÿã˜ã‚‹ã®ã¯ã©ã‚“ãªæ™‚ï¼Ÿ", options: [{ label: "ã€Œã‚ã‚ŠãŒã¨ã†ã€ã¨è¨€ã‚ã‚ŒãŸæ™‚", skill: "ãƒ›ã‚¹ãƒ”ã‚¿ãƒªãƒ†ã‚£" }, { label: "ãã®äººãŒæˆé•·ã—ãŸå§¿ã‚’è¦‹ãŸæ™‚", skill: "è‚²æˆåŠ›" }, { label: "ãƒˆãƒ©ãƒ–ãƒ«ã‚’æœªç„¶ã«é˜²ã’ãŸæ™‚", skill: "ãƒªã‚¹ã‚¯ç®¡ç†" }] },
    { text: "ç›¸æ‰‹ãŒä½•ã‚’æ±‚ã‚ã¦ã„ã‚‹ã‹ã€è¨€è‘‰ã«ã—ãªãã¦ã‚‚ã‚ã‹ã‚Šã¾ã™ã‹ï¼Ÿ", options: [{ label: "è¡¨æƒ…ã‚„å£°è‰²ã§å¤§ä½“ã‚ã‹ã‚‹", skill: "æ´å¯ŸåŠ›" }, { label: "èƒŒæ™¯ã‚„æ–‡è„ˆã‹ã‚‰æ¨æ¸¬ã§ãã‚‹", skill: "æ–‡è„ˆç†è§£åŠ›" }, { label: "ã‚ã‹ã‚‰ãªã„ã®ã§ä¸å¯§ã«ãƒ’ã‚¢ãƒªãƒ³ã‚°ã™ã‚‹", skill: "ãƒ’ã‚¢ãƒªãƒ³ã‚°åŠ›" }] },
    { text: "è‡ªåˆ†ãŒç›®ç«‹ã¤ã“ã¨ã¨ã€é»’å­ã«å¾¹ã™ã‚‹ã“ã¨ã€ã©ã¡ã‚‰ãŒå¥½ãï¼Ÿ", options: [{ label: "é»’å­ã¨ã—ã¦æ”¯ãˆã‚‹ã®ãŒå¥½ã", skill: "ã‚µãƒ¼ãƒãƒ³ãƒˆãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—" }, { label: "ãŸã¾ã«ã¯è©•ä¾¡ã•ã‚ŒãŸã„", skill: "å¥å…¨ãªæ‰¿èªæ¬²æ±‚" }, { label: "ãƒãƒ¼ãƒ ã®æ‰‹æŸ„ã«ãªã‚‹ãªã‚‰ä½•ã§ã‚‚ã„ã„", skill: "ãƒãƒ¼ãƒ å¿—å‘" }] },
    { text: "å¿™ã—ãã†ãªåŒåƒšãŒã„ã¾ã™ã€‚ã©ã†å£°ã‚’ã‹ã‘ã¾ã™ã‹ï¼Ÿ", options: [{ label: "ã€Œä½•ã‹æ‰‹ä¼ãŠã†ã‹ï¼Ÿã€", skill: "ç©æ¥µçš„æ”¯æ´" }, { label: "ãŠè“å­ã‚’å·®ã—å…¥ã‚Œã‚‹", skill: "æ°—é…ã‚Š" }, { label: "ã‚ãˆã¦ãã£ã¨ã—ã¦ãŠã", skill: "çŠ¶æ³åˆ¤æ–­åŠ›" }] },
  ],
  analyst: [
    { text: "ä¸æ˜ç¢ºãªèª²é¡Œã«ç›´é¢ã—ã¾ã—ãŸã€‚ã¾ãšä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ", options: [{ label: "ãƒ‡ãƒ¼ã‚¿ã‚’é›†ã‚ã¦ç¾çŠ¶ã‚’å¯è¦–åŒ–ã™ã‚‹", skill: "ãƒ‡ãƒ¼ã‚¿åˆ†æåŠ›" }, { label: "è¦ç´ åˆ†è§£ã—ã¦ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’æ¢ã™", skill: "æ§‹é€ åŒ–æ€è€ƒ" }, { label: "è©³ã—ã„äººã«è©±ã‚’èãã«è¡Œã", skill: "æƒ…å ±åé›†åŠ›" }] },
    { text: "èª¬æ˜è³‡æ–™ã‚’ä½œã‚‹æ™‚ã€æœ€ã‚‚ã“ã ã‚ã‚‹ã®ã¯ï¼Ÿ", options: [{ label: "è«–ç†ã®ç ´ç¶»ãŒãªã„ã“ã¨", skill: "ãƒ­ã‚¸ã‚«ãƒ«ã‚·ãƒ³ã‚­ãƒ³ã‚°" }, { label: "æ•°å­—ã‚„æ ¹æ‹ ã®æ­£ç¢ºã•", skill: "ãƒ•ã‚¡ã‚¯ãƒˆãƒ™ãƒ¼ã‚¹æ€è€ƒ" }, { label: "èª°ãŒè¦‹ã¦ã‚‚ã‚ã‹ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ã•", skill: "è¦ç´„åŠ›" }] },
    { text: "æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ã‚„æŠ€è¡“ã‚’å°å…¥ã™ã‚‹éš›ã€ã©ã†åˆ¤æ–­ã—ã¾ã™ã‹ï¼Ÿ", options: [{ label: "ã‚³ã‚¹ãƒˆå¯¾åŠ¹æœã‚’è¨ˆç®—ã™ã‚‹", skill: "ROIè¦–ç‚¹" }, { label: "ä»•æ§˜ã‚„ã‚¹ãƒšãƒƒã‚¯ã‚’å¾¹åº•çš„ã«èª¿ã¹ã‚‹", skill: "æŠ€è¡“é¸å®šçœ¼" }, { label: "ã¨ã‚Šã‚ãˆãšè©¦ã—ã¦åˆ¤æ–­ã™ã‚‹", skill: "æ¤œè¨¼åŠ›" }] },
    { text: "æ„Ÿæƒ…çš„ãªè­°è«–ã«ãªã£ãŸæ™‚ã€ã©ã†æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ", options: [{ label: "æ™‚é–“ã®ç„¡é§„ã ã¨æ„Ÿã˜ã‚‹", skill: "åˆç†æ€§è¿½æ±‚" }, { label: "æ„Ÿæƒ…ã®è£ã«ã‚ã‚‹åŸå› ã‚’æ¢ã‚‹", skill: "å¿ƒç†åˆ†æ" }, { label: "å†·é™ã«äº‹å®Ÿã«å¼•ãæˆ»ãã†ã¨ã™ã‚‹", skill: "å®¢è¦³è¦–ç‚¹" }] },
    { text: "ã€Œå°‚é–€å®¶ã€ã¨ã—ã¦é ¼ã‚‰ã‚Œã‚‹ã“ã¨ã«ã¤ã„ã¦ã©ã†æ€ã„ã¾ã™ã‹ï¼Ÿ", options: [{ label: "èª‡ã‚‰ã—ã„ã€ã‚‚ã£ã¨æ·±ã‚ãŸã„", skill: "æ¢ç©¶å¿ƒ" }, { label: "ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã ãŒæ‚ªããªã„", skill: "è²¬ä»»æ„Ÿ" }, { label: "å¹…åºƒãçŸ¥ã£ã¦ã„ãŸã„ã®ã§å°‚é–€ç‰¹åŒ–ã¯è¿·ã†", skill: "çŸ¥çš„å¥½å¥‡å¿ƒ" }] },
  ],
  leader: [
    { text: "èª°ã‚‚ã‚„ã‚ŠãŸãŒã‚‰ãªã„å›°é›£ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚ã©ã†ã—ã¾ã™ã‹ï¼Ÿ", options: [{ label: "ãƒãƒ£ãƒ³ã‚¹ã ã¨æ€ã„æ‰‹ã‚’æŒ™ã’ã‚‹", skill: "ãƒãƒ£ãƒ¬ãƒ³ã‚¸ç²¾ç¥" }, { label: "ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ãªã‚‰ã‚„ã‚‹", skill: "æˆ¦ç•¥çš„æ€è€ƒ" }, { label: "èª°ã‹ã‚’æŒ‡åã—ã¦ä»»ã›ã‚‹", skill: "æ¨©é™å§”è­²" }] },
    { text: "å¤§ããªæ±ºæ–­ã‚’ã™ã‚‹æ™‚ã€ä½•ã‚’é‡è¦–ã—ã¾ã™ã‹ï¼Ÿ", options: [{ label: "ç›´æ„Ÿã¨ãƒ“ã‚¸ãƒ§ãƒ³", skill: "ãƒ“ã‚¸ãƒ§ãƒŠãƒªãƒ¼æ€è€ƒ" }, { label: "å‹ç®—ï¼ˆæˆåŠŸç¢ºç‡ï¼‰", skill: "ãƒªã‚¹ã‚¯è¨ˆç®—" }, { label: "ãƒãƒ¼ãƒ ã®ç·æ„", skill: "åˆæ„å½¢æˆåŠ›" }] },
    { text: "éƒ¨ä¸‹ãŒãƒŸã‚¹ã‚’ã—ã¾ã—ãŸã€‚ã©ã†å¯¾å¿œã—ã¾ã™ã‹ï¼Ÿ", options: [{ label: "åŸå› ã‚’åˆ†æã—ã€å†ç™ºé˜²æ­¢ç­–ã‚’è€ƒãˆã•ã›ã‚‹", skill: "å•é¡Œè§£æ±ºæ”¯æ´" }, { label: "è²¬ä»»ã¯è‡ªåˆ†ãŒå–ã‚Šã€æŒ½å›ã®æ©Ÿä¼šã‚’ä¸ãˆã‚‹", skill: "è²¬ä»»æ„Ÿãƒ»åŒ…å®¹åŠ›" }, { label: "å³ã—ãæŒ‡å°ã™ã‚‹", skill: "è¦å¾‹ç¶­æŒ" }] },
    { text: "ç›®æ¨™æœªé”ã«ãªã‚Šãã†ã§ã™ã€‚ã©ã†æŒ½å›ã—ã¾ã™ã‹ï¼Ÿ", options: [{ label: "æ°—åˆã„ã‚’å…¥ã‚Œç›´ã—ã€è¡Œå‹•é‡ã‚’å¢—ã‚„ã™", skill: "è¡Œå‹•åŠ›" }, { label: "ã‚„ã‚Šæ–¹ã‚’æ ¹æœ¬ã‹ã‚‰å¤‰ãˆã‚‹", skill: "å¤‰é©åŠ›" }, { label: "ãƒªã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ èª¿é”ã™ã‚‹", skill: "äº¤æ¸‰åŠ›" }] },
    { text: "å°†æ¥ã€ã©ã†ãªã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ", options: [{ label: "çµŒå–¶è€…ã‚„äº‹æ¥­è²¬ä»»è€…", skill: "çµŒå–¶è¦–ç‚¹" }, { label: "æ¥­ç•Œã®ç¬¬ä¸€äººè€…", skill: "ãƒ–ãƒ©ãƒ³ãƒ‰æ§‹ç¯‰åŠ›" }, { label: "è‡ªç”±ãªè³‡ç”£å®¶", skill: "ç›®æ¨™é”æˆåŠ›" }] },
  ],
};

// Phase 3: ã‚¹ã‚­ãƒ«ç™ºæ˜ (Can) - å…¨ã‚¿ã‚¤ãƒ—å…±é€šã ãŒã€çµŒé¨“ã‚’å•ã†
const QUESTIONS_PHASE_3 = [
  { text: "äººå‰ã§ãƒ—ãƒ¬ã‚¼ãƒ³ã‚„ç™ºè¡¨ã‚’ã™ã‚‹ã“ã¨ã¯ï¼Ÿ", options: [{ label: "å¾—æ„ã€ã‚€ã—ã‚å¥½ã", tag: "ãƒ—ãƒ¬ã‚¼ãƒ³åŠ›" }, { label: "æº–å‚™ã™ã‚Œã°å•é¡Œãªãã§ãã‚‹", tag: "èª¬æ˜åŠ›" }, { label: "ã§ãã‚Œã°é¿ã‘ãŸã„", tag: null }] },
  { text: "Excelã‚„ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§é–¢æ•°ã‚’çµ„ã‚“ã ã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚’åŠ å·¥ã™ã‚‹ã®ã¯ï¼Ÿ", options: [{ label: "æ¯ã‚’ã™ã‚‹ã‚ˆã†ã«ã§ãã‚‹", tag: "ãƒ‡ãƒ¼ã‚¿å‡¦ç†" }, { label: "èª¿ã¹ãªãŒã‚‰ãªã‚‰ã§ãã‚‹", tag: "ITãƒªãƒ†ãƒ©ã‚·ãƒ¼" }, { label: "è‹¦æ‰‹", tag: null }] },
  { text: "åˆå¯¾é¢ã®äººã¨æ‰“ã¡è§£ã‘ã‚‹ã®ã¯ï¼Ÿ", options: [{ label: "ã™ãã«ä»²è‰¯ããªã‚Œã‚‹", tag: "é–¢ä¿‚æ§‹ç¯‰åŠ›" }, { label: "ä»•äº‹ãªã‚‰å•é¡Œãªã„", tag: "ãƒ“ã‚¸ãƒã‚¹ã‚³ãƒŸãƒ¥åŠ›" }, { label: "æ™‚é–“ãŒã‹ã‹ã‚‹", tag: null }] },
  { text: "æ–‡ç« ã‚’æ›¸ãã“ã¨ï¼ˆãƒ¡ãƒ¼ãƒ«ã€è³‡æ–™ã€ãƒ–ãƒ­ã‚°ç­‰ï¼‰ã¯ï¼Ÿ", options: [{ label: "è‹¦ã«ãªã‚‰ãªã„ã€é€Ÿã„", tag: "ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°" }, { label: "æ¨æ•²ã™ã‚Œã°æ›¸ã‘ã‚‹", tag: "æ–‡æ›¸ä½œæˆ" }, { label: "æ›¸ãã‚ˆã‚Šè©±ã—ãŸã„", tag: null }] },
  { text: "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã‚„ã‚¿ã‚¹ã‚¯ç®¡ç†ã¯ï¼Ÿ", options: [{ label: "ç·»å¯†ã«ç®¡ç†ã—ã¦ã„ã‚‹", tag: "é€²æ—ç®¡ç†" }, { label: "å¤§æ ã¯å®ˆã‚Œã‚‹", tag: "ã‚»ãƒ«ãƒ•ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ" }, { label: "ã‚ˆãæŠœã‘æ¼ã‚Œã‚‹", tag: null }] },
  { text: "é£²ã¿ä¼šã®å¹¹äº‹ã‚„æ—…è¡Œã®è¨ˆç”»ç«‹ã¦ã¯ï¼Ÿ", options: [{ label: "ã‚ˆãã‚„ã‚‹ã€å¥½ã", tag: "ä¼ç”»ãƒ»èª¿æ•´" }, { label: "é ¼ã¾ã‚Œã‚Œã°ã‚„ã‚‹", tag: "å®Ÿè¡ŒåŠ›" }, { label: "ä»»ã›ãŸã„", tag: null }] },
  { text: "å¾Œè¼©ã‚„æ–°äººã«æ•™ãˆã‚‹ã“ã¨ã¯ï¼Ÿ", options: [{ label: "ã‚ã‹ã‚Šã‚„ã™ã„ã¨è¨€ã‚ã‚Œã‚‹", tag: "ãƒ†ã‚£ãƒ¼ãƒãƒ³ã‚°" }, { label: "èƒŒä¸­ã§è¦‹ã›ã‚‹ã‚¿ã‚¤ãƒ—", tag: "ãƒ¢ãƒ‡ãƒªãƒ³ã‚°" }, { label: "è‡ªåˆ†ã®ã“ã¨ã§ç²¾ä¸€æ¯", tag: null }] },
  { text: "è‹±èªã‚„å¤–å›½èªã‚’ä½¿ã†æ©Ÿä¼šã¯ï¼Ÿ", options: [{ label: "å®Ÿå‹™ã§ä½¿ã£ã¦ã„ã‚‹", tag: "èªå­¦åŠ›" }, { label: "èª­ã¿æ›¸ããªã‚‰ã§ãã‚‹", tag: "æƒ…å ±åé›†(è‹±èª)" }, { label: "ç¿»è¨³ãƒ„ãƒ¼ãƒ«é ¼ã¿", tag: null }] },
  { text: "ãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ããŸæ™‚ã®ãƒ¡ãƒ³ã‚¿ãƒ«ã¯ï¼Ÿ", options: [{ label: "å†·é™ã«å¯¾å‡¦ã§ãã‚‹", tag: "ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§" }, { label: "ç„¦ã‚‹ãŒãªã‚“ã¨ã‹ã™ã‚‹", tag: "æŸ”è»Ÿæ€§" }, { label: "ãƒ‘ãƒ‹ãƒƒã‚¯ã«ãªã‚‹", tag: null }] },
  { text: "æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚„Webã‚µãƒ¼ãƒ“ã‚¹ã¯ï¼Ÿ", options: [{ label: "ã™ãã«è©¦ã™", tag: "ãƒ‡ã‚¸ã‚¿ãƒ«æ„Ÿåº¦" }, { label: "å¿…è¦ãªã‚‰ä½¿ã†", tag: "å­¦ç¿’æ„æ¬²" }, { label: "æ…£ã‚ŒãŸã‚‚ã®ãŒã„ã„", tag: null }] },
];

// --- APIå‘¼ã³å‡ºã—é–¢æ•° ---
const apiKey = ""; // å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã¾ã™

const callGemini = async (prompt) => {
  const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
  const payload = {
    contents: [{ parts: [{ text: prompt }] }],
  };

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    if (!response.ok) {
      throw new Error(`API call failed: ${response.statusText}`);
    }

    const data = await response.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚AIã‹ã‚‰ã®å¿œç­”ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";
  } catch (error) {
    console.error("Gemini API Error:", error);
    return "ç¾åœ¨ã€AIã‚µãƒ¼ãƒ“ã‚¹ãŒæ··ã¿åˆã£ã¦ã„ã‚‹ã‹ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚ã—ã°ã‚‰ãçµŒã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚";
  }
};

// --- ãƒ˜ãƒ«ãƒ‘ãƒ¼: æ”¹è‰¯ç‰ˆSimpleMarkdown ---
// ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œã”ã¨ã«è§£æã—ã€è¦‹å‡ºã—ãƒ»ãƒªã‚¹ãƒˆãƒ»å¤ªå­—ã‚’Reactè¦ç´ ã¨ã—ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
const SimpleMarkdown = ({ text }) => {
  if (!text) return null;

  // ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œã§åˆ†å‰²
  const lines = text.split('\n');
  const elements = [];
  let listBuffer = [];

  // å¤ªå­—ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦Reactè¦ç´ ã®é…åˆ—ã‚’è¿”ã™é–¢æ•°
  const parseBoldText = (str, keyPrefix) => {
    const parts = str.split(/(\*\*.*?\*\*)/g);
    return parts.map((part, index) => {
      if (part.startsWith('**') && part.endsWith('**')) {
        return <strong key={`${keyPrefix}-bold-${index}`} className="text-indigo-900 bg-yellow-100 px-1 rounded">{part.slice(2, -2)}</strong>;
      }
      return part;
    });
  };

  lines.forEach((line, index) => {
    const trimmed = line.trim();

    // 1. ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ  (- ã¾ãŸã¯ *) ã®å ´åˆ
    if (trimmed.startsWith('- ') || trimmed.startsWith('* ')) {
      listBuffer.push(trimmed.substring(2));
    } else {
      // ãƒªã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡ãŒã‚ã‚Œã°ã€ã“ã“ã§<ul>ã¨ã—ã¦æ›¸ãå‡ºã—ã€ãƒãƒƒãƒ•ã‚¡ã‚’ã‚¯ãƒªã‚¢
      if (listBuffer.length > 0) {
        elements.push(
          <ul key={`list-group-${index}`} className="list-disc pl-5 space-y-2 text-gray-700 bg-indigo-50/50 p-4 rounded-lg my-3 border border-indigo-100">
            {listBuffer.map((item, i) => (
              <li key={`li-${index}-${i}`}>
                {parseBoldText(item, `li-${index}-${i}`)}
              </li>
            ))}
          </ul>
        );
        listBuffer = [];
      }

      // 2. ç©ºè¡Œ
      if (trimmed === '') {
        // ä½™ç™½ã‚’è¿½åŠ 
        elements.push(<div key={`spacer-${index}`} className="h-2" />);
        return;
      }

      // 3. è¦‹å‡ºã— (###)
      if (trimmed.startsWith('###')) {
        elements.push(
          <h3 key={`h3-${index}`} className="text-xl font-bold text-indigo-800 mt-6 mb-3 border-b-2 border-indigo-100 pb-1 flex items-center">
            <span className="text-2xl mr-2 text-indigo-400">#</span>
            {trimmed.replace(/^###\s*/, '')}
          </h3>
        );
        return;
      }
      
      // 4. è¦‹å‡ºã— (**) - å˜ç‹¬è¡Œã§å¤ªå­—ã®ã¿ã®å ´åˆã¯è¦‹å‡ºã—æ‰±ã„ã«ã™ã‚‹
      if (trimmed.startsWith('**') && trimmed.endsWith('**') && trimmed.length < 50 && !trimmed.includes(' ')) {
         elements.push(
          <h3 key={`h-bold-${index}`} className="text-lg font-bold text-indigo-800 mt-5 mb-2 pl-3 border-l-4 border-indigo-400 bg-gray-50 py-1">
            {trimmed.replace(/\*\*/g, '')}
          </h3>
        );
        return;
      }

      // 5. é€šå¸¸ã®æ®µè½
      elements.push(
        <p key={`p-${index}`} className="text-gray-700 leading-relaxed my-1">
           {parseBoldText(line, `p-${index}`)}
        </p>
      );
    }
  });

  // ãƒ«ãƒ¼ãƒ—çµ‚äº†å¾Œã«æ®‹ã£ã¦ã„ã‚‹ãƒªã‚¹ãƒˆãŒã‚ã‚Œã°æ›¸ãå‡ºã—
  if (listBuffer.length > 0) {
    elements.push(
      <ul key={`list-group-end`} className="list-disc pl-5 space-y-2 text-gray-700 bg-indigo-50/50 p-4 rounded-lg my-3 border border-indigo-100">
        {listBuffer.map((item, i) => (
          <li key={`li-end-${i}`}>
            {parseBoldText(item, `li-end-${i}`)}
          </li>
        ))}
      </ul>
    );
  }

  return <div className="space-y-1 text-left">{elements}</div>;
};

// --- ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ---

const App = () => {
  const [screen, setScreen] = useState('welcome'); 
  const [phase, setPhase] = useState(1);
  const [qIndex, setQIndex] = useState(0);
  
  // ã‚¹ã‚³ã‚¢ç®¡ç†
  const [scores, setScores] = useState({ creator: 0, supporter: 0, analyst: 0, leader: 0 });
  const [determinedType, setDeterminedType] = useState(null); // Phase 1ã§æ±ºå®š
  
  // å›ç­”å±¥æ­´ã¨ã‚¹ã‚­ãƒ«ã‚¿ã‚°
  const [history, setHistory] = useState([]);
  const [detectedSkills, setDetectedSkills] = useState([]);

  // AIé–¢é€£ã‚¹ãƒ†ãƒ¼ãƒˆ
  const [aiReport, setAiReport] = useState(null);
  const [isGenerating, setIsGenerating] = useState(false);

  // --- ãƒ­ã‚¸ãƒƒã‚¯ ---

  // è¨ºæ–­é–‹å§‹
  const startDiagnosis = () => {
    setScreen('question');
    setPhase(1);
    setQIndex(0);
    setScores({ creator: 0, supporter: 0, analyst: 0, leader: 0 });
    setHistory([]);
    setDetectedSkills([]);
    setDeterminedType(null);
    setAiReport(null); // AIãƒ¬ãƒãƒ¼ãƒˆãƒªã‚»ãƒƒãƒˆ
  };

  // å›ç­”ãƒãƒ³ãƒ‰ãƒ©
  const handleAnswer = (option, questionText) => {
    // å±¥æ­´è¨˜éŒ²
    setHistory(prev => [...prev, { q: questionText, a: option.label }]);

    if (phase === 1) {
      // Phase 1: ã‚¹ã‚³ã‚¢åŠ ç®—
      setScores(prev => ({ ...prev, [option.type]: prev[option.type] + option.score }));
      
      if (qIndex < QUESTIONS_PHASE_1.length - 1) {
        setQIndex(prev => prev + 1);
      } else {
        // Phase 1 çµ‚äº† -> ã‚¿ã‚¤ãƒ—æ±ºå®š -> Phase 2ã¸
        const sortedTypes = Object.entries(scores).sort((a, b) => b[1] - a[1]);
        // ç°¡æ˜“çš„ã«ç¾çŠ¶ã®scores + ä»Šå›ã®optionã‚’åŠ å‘³ã—ã¦åˆ¤å®š
        const finalScores = { ...scores, [option.type]: scores[option.type] + option.score };
        const winner = Object.entries(finalScores).sort((a, b) => b[1] - a[1])[0][0];
        
        setDeterminedType(winner);
        setPhase(2);
        setQIndex(0);
      }
    } else if (phase === 2) {
      // Phase 2: ã‚¹ã‚­ãƒ«æŠ½å‡ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«skillãŒã‚ã‚Œã°ï¼‰
      if (option.skill) {
        setDetectedSkills(prev => [...prev, option.skill]);
      }

      const p2Questions = QUESTIONS_PHASE_2[determinedType];
      if (qIndex < p2Questions.length - 1) {
        setQIndex(prev => prev + 1);
      } else {
        // Phase 2 çµ‚äº† -> Phase 3ã¸
        setPhase(3);
        setQIndex(0);
      }
    } else if (phase === 3) {
      // Phase 3: å®Ÿå‹™ã‚¹ã‚­ãƒ«åˆ¤å®š
      if (option.tag) {
        setDetectedSkills(prev => [...prev, option.tag]);
      }

      if (qIndex < QUESTIONS_PHASE_3.length - 1) {
        setQIndex(prev => prev + 1);
      } else {
        // å…¨çµ‚äº† -> çµæœç”»é¢
        setScreen('analyzing');
        setTimeout(() => setScreen('result'), 2500);
      }
    }
  };

  // AIãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  const generateAIReport = async () => {
    setIsGenerating(true);
    const typeData = ARCHETYPES[determinedType];
    const uniqueSkills = [...new Set(detectedSkills)];
    
    const prompt = `
      ã‚ãªãŸã¯ãƒ—ãƒ­ã®ã‚­ãƒ£ãƒªã‚¢ã‚³ãƒ³ã‚µãƒ«ã‚¿ãƒ³ãƒˆã§ã™ã€‚
      ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨ºæ–­çµæœã«åŸºã¥ãã€å…·ä½“çš„ã‹ã¤å®Ÿè·µçš„ãªã‚­ãƒ£ãƒªã‚¢æˆ¦ç•¥ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
      å£èª¿ã¯ãƒã‚¸ãƒ†ã‚£ãƒ–ã§ã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã‹ã¤è¦ªã—ã¿ã‚„ã™ã„ãƒˆãƒ¼ãƒ³ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚

      ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã€‘
      - ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—: ${typeData.name} (${typeData.desc})
      - æ¤œå‡ºã•ã‚ŒãŸã‚¹ã‚­ãƒ«ã‚¿ã‚°: ${uniqueSkills.join(', ') || "ç‰¹ã«ãªã—"}
      - ä¸»ãªå¼·ã¿: ${typeData.strengths.join(', ')}
      - å›ç­”ã®å‚¾å‘ï¼ˆä¸€éƒ¨ï¼‰:
        ${history.slice(0, 5).map(h => `Q: ${h.q} -> A: ${h.a}`).join('\n')}

      ã€å‡ºåŠ›ã—ã¦ã»ã—ã„é …ç›®ã€‘
      1. **âœ¨ ã‚ãªãŸã®éš ã‚ŒãŸå¯èƒ½æ€§**: ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ã¨ã‚¹ã‚­ãƒ«ã‚’çµ„ã¿åˆã‚ã›ãŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç‹¬è‡ªã®å¸‚å ´ä¾¡å€¤ã«ã¤ã„ã¦ã®åˆ†æã€‚
      2. **ğŸš€ æ˜æ—¥ã‹ã‚‰å§‹ã‚ã‚‹ã¹ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³3é¸**: è»¢è·æ´»å‹•ã‚„ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã®ãŸã‚ã«ã€ä»Šã™ãã§ãã‚‹å…·ä½“çš„ãªè¡Œå‹•ã€‚
      3. **ğŸ“ è·å‹™çµŒæ­´æ›¸ç”¨ã€Œè‡ªå·±PRã€ãƒ‰ãƒ©ãƒ•ãƒˆ**: æ¤œå‡ºã•ã‚ŒãŸã‚¹ã‚­ãƒ«ã‚’ç”¨ã„ãŸã€èª¬å¾—åŠ›ã®ã‚ã‚‹è‡ªå·±PRã®ä¾‹æ–‡ï¼ˆ200æ–‡å­—ç¨‹åº¦ï¼‰ã€‚
      4. **ğŸ’¼ ãŠã™ã™ã‚ã®æ„å¤–ãªè·ç¨®**: å®šç•ªã®è·ç¨®ä»¥å¤–ã§ã€ã“ã®ã‚¿ã‚¤ãƒ—ãŒè¼ã‘ã‚‹ãƒ‹ãƒƒãƒãªã€ã‚ã‚‹ã„ã¯æ„å¤–æ€§ã®ã‚ã‚‹è·ç¨®ææ¡ˆã€‚

      å‡ºåŠ›ã¯ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼ã§è¡Œã£ã¦ãã ã•ã„ã€‚è¦‹å‡ºã—ã¯###ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
    `;

    const result = await callGemini(prompt);
    setAiReport(result);
    setIsGenerating(false);
  };

  // ç¾åœ¨ã®è³ªå•ã‚’å–å¾—
  const getCurrentQuestion = () => {
    if (phase === 1) return QUESTIONS_PHASE_1[qIndex];
    if (phase === 2) return QUESTIONS_PHASE_2[determinedType][qIndex];
    if (phase === 3) return QUESTIONS_PHASE_3[qIndex];
    return null;
  };

  // é€²æ—ç‡
  const getProgress = () => {
    const totalP1 = QUESTIONS_PHASE_1.length;
    const totalP2 = determinedType ? QUESTIONS_PHASE_2[determinedType].length : 5;
    const totalP3 = QUESTIONS_PHASE_3.length;
    const total = totalP1 + totalP2 + totalP3;
    
    let current = qIndex;
    if (phase > 1) current += totalP1;
    if (phase > 2) current += totalP2;
    
    return Math.round((current / total) * 100);
  };

  // --- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ---

  const renderWelcome = () => (
    <div className="flex flex-col items-center justify-center text-center space-y-6 animate-fade-in py-10">
      <div className="bg-indigo-600 p-5 rounded-3xl shadow-xl mb-4">
        <Sparkles className="w-16 h-16 text-white" />
      </div>
      <h1 className="text-4xl md:text-5xl font-extrabold text-gray-900 tracking-tight">
        Self-Discovery<br/><span className="text-indigo-600">Compass Pro</span>
      </h1>
      <div className="max-w-md text-gray-600 space-y-2 text-lg">
        <p>ã‚ãªãŸã®ã€Œã‚­ãƒ£ãƒªã‚¢ã®åŸçŸ³ã€ã‚’æ˜ã‚Šèµ·ã“ã™<br/>AIæ­è¼‰ã®æœ¬æ ¼çš„ãªè‡ªå·±åˆ†æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚</p>
        <p className="text-sm bg-gray-100 py-2 px-4 rounded-full inline-block mt-4">
          â± æ‰€è¦æ™‚é–“: ç´„3åˆ† / å…¨30ã€œ40å•
        </p>
      </div>
      
      <div className="grid gap-3 w-full max-w-sm mt-6 text-left text-sm text-gray-500 bg-white p-6 rounded-xl border border-gray-200">
        <div className="flex items-center"><span className="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">1</span> åŸºç¤è¨ºæ–­ã§ã‚¿ã‚¤ãƒ—ã‚’ç‰¹å®š</div>
        <div className="flex items-center"><span className="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">2</span> ã‚¿ã‚¤ãƒ—åˆ¥ã®æ·±æ˜ã‚Šè³ªå•</div>
        <div className="flex items-center"><span className="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">3</span> éš ã‚ŒãŸå®Ÿå‹™ã‚¹ã‚­ãƒ«ã®ç™ºæ˜</div>
      </div>

      <button
        onClick={startDiagnosis}
        className="mt-8 px-10 py-4 bg-indigo-600 text-white rounded-full font-bold text-xl shadow-lg hover:bg-indigo-700 hover:shadow-2xl transition-all transform hover:-translate-y-1 flex items-center"
      >
        åˆ†æã‚’é–‹å§‹ã™ã‚‹ <ArrowRight className="ml-2 w-6 h-6" />
      </button>
    </div>
  );

  const renderQuestion = () => {
    const question = getCurrentQuestion();
    const progress = getProgress();

    return (
      <div className="max-w-2xl mx-auto w-full animate-slide-up min-h-[400px] flex flex-col">
        <div className="mb-6">
          <div className="flex justify-between text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">
            <span>Phase {phase} / 3</span>
            <span>{progress}% Completed</span>
          </div>
          <div className="w-full bg-gray-100 rounded-full h-2">
            <div 
              className="bg-indigo-600 h-2 rounded-full transition-all duration-500 ease-out" 
              style={{ width: `${progress}%` }}
            ></div>
          </div>
        </div>

        <div className="flex-1">
          <h2 className="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-relaxed">
            <span className="text-indigo-500 text-lg block mb-2 font-medium">
              Q. {phase === 1 ? "åŸºæœ¬" : phase === 2 ? "æ·±æ˜ã‚Š" : "ã‚¹ã‚­ãƒ«"}
            </span>
            {question.text}
          </h2>

          <div className="space-y-3">
            {question.options.map((option, idx) => (
              <button
                key={idx}
                onClick={() => handleAnswer(option, question.text)}
                className="w-full text-left p-5 rounded-xl border border-gray-200 bg-white hover:bg-indigo-50 hover:border-indigo-400 transition-all shadow-sm hover:shadow-md group relative overflow-hidden"
              >
                <div className="flex items-center justify-between relative z-10">
                  <span className="text-lg text-gray-700 group-hover:text-indigo-900 font-medium">{option.label}</span>
                  <ChevronRight className="text-gray-300 group-hover:text-indigo-500" />
                </div>
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const renderResult = () => {
    const typeData = ARCHETYPES[determinedType];
    // ã‚¹ã‚­ãƒ«ã®é‡è¤‡å‰Šé™¤
    const uniqueSkills = [...new Set(detectedSkills)];

    return (
      <div className="max-w-4xl mx-auto w-full animate-fade-in pb-20">
        
        {/* ãƒ˜ãƒƒãƒ€ãƒ¼: ã‚¿ã‚¤ãƒ—çµæœ */}
        <div className="bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100 mb-8">
          <div className="bg-gradient-to-r from-indigo-900 to-purple-800 p-8 md:p-12 text-center text-white relative overflow-hidden">
            <div className="absolute top-0 left-0 w-full h-full opacity-10">
              <Sparkles className="w-full h-full" />
            </div>
            <p className="text-indigo-200 font-medium mb-4 tracking-widest uppercase">Analysis Complete</p>
            <h2 className="text-3xl md:text-5xl font-extrabold mb-4">{typeData.name}</h2>
            <p className="text-indigo-100 text-lg max-w-2xl mx-auto leading-relaxed opacity-90">
              {typeData.desc}
            </p>
          </div>

          <div className="p-8 md:p-10 grid md:grid-cols-2 gap-10">
            {/* å¼·ã¿ã¨å¼±ã¿ */}
            <div>
              <h3 className="font-bold text-gray-800 text-xl mb-4 flex items-center">
                <TrendingUp className="w-6 h-6 text-indigo-600 mr-2" />
                ã‚ãªãŸã®æ­¦å™¨ï¼ˆå¼·ã¿ï¼‰
              </h3>
              <ul className="space-y-2 mb-8">
                {typeData.strengths.map((s, i) => (
                  <li key={i} className="flex items-start bg-indigo-50 p-3 rounded-lg text-indigo-900">
                    <Check className="w-5 h-5 text-indigo-600 mr-2 flex-shrink-0" />
                    {s}
                  </li>
                ))}
              </ul>

              <h3 className="font-bold text-gray-800 text-xl mb-4 flex items-center">
                <AlertTriangle className="w-6 h-6 text-orange-500 mr-2" />
                é¿ã‘ã‚‹ã¹ãç’°å¢ƒï¼ˆå¼±ã¿ï¼‰
              </h3>
              <ul className="space-y-2">
                {typeData.weaknesses.map((w, i) => (
                  <li key={i} className="flex items-start bg-orange-50 p-3 rounded-lg text-orange-900">
                    <span className="w-5 h-5 text-orange-500 mr-2 flex-shrink-0">âš </span>
                    {w}
                  </li>
                ))}
              </ul>
            </div>

            {/* é©è·ã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ */}
            <div>
              <h3 className="font-bold text-gray-800 text-xl mb-4 flex items-center">
                <Target className="w-6 h-6 text-blue-600 mr-2" />
                è¼ã‘ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆé©è·ï¼‰
              </h3>
              <div className="flex flex-wrap gap-2 mb-8">
                {typeData.suitable_jobs.map((job, i) => (
                  <span key={i} className="px-4 py-2 bg-white border-2 border-blue-100 text-blue-800 rounded-full font-bold shadow-sm">
                    {job}
                  </span>
                ))}
              </div>

              <div className="bg-gray-50 p-6 rounded-2xl border border-gray-200">
                <h3 className="font-bold text-gray-800 mb-3 flex items-center">
                  <Smile className="w-5 h-5 text-yellow-500 mr-2" />
                  ã‚­ãƒ£ãƒªã‚¢ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã‹ã‚‰ã®åŠ©è¨€
                </h3>
                <p className="text-gray-700 leading-relaxed text-sm">
                  {typeData.advice}
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* ã‚¹ã‚­ãƒ«ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª */}
        <div className="bg-white rounded-3xl shadow-lg p-8 border border-gray-100 mb-8">
          <h3 className="font-bold text-gray-800 text-2xl mb-6 flex items-center border-b pb-4">
            <Award className="w-8 h-8 text-yellow-500 mr-3" />
            ç™ºæ˜ã•ã‚ŒãŸã€ŒCanï¼ˆã§ãã‚‹ã“ã¨ï¼‰ã€ãƒªã‚¹ãƒˆ
          </h3>
          <p className="text-gray-600 mb-6">
            å›ç­”ã‹ã‚‰åˆ†æã•ã‚ŒãŸã€ã‚ãªãŸãŒæ—¢ã«æŒã£ã¦ã„ã‚‹ã€ã‚ã‚‹ã„ã¯ç´ é¤ŠãŒã‚ã‚‹ã‚¹ã‚­ãƒ«ã‚»ãƒƒãƒˆã§ã™ã€‚<br/>
            è·å‹™çµŒæ­´æ›¸ã®ã€Œè‡ªå·±PRã€ã‚„ã€Œæ´»ã‹ã›ã‚‹çµŒé¨“ã€ã®æ¬„ã«ãã®ã¾ã¾ä½¿ãˆã¾ã™ã€‚
          </p>
          
          {uniqueSkills.length > 0 ? (
            <div className="flex flex-wrap gap-3">
              {uniqueSkills.map((skill, i) => (
                <div key={i} className="flex items-center px-5 py-3 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border border-gray-200 shadow-sm text-gray-800 font-bold">
                  <Zap className="w-4 h-4 text-yellow-500 mr-2 fill-current" />
                  {skill}
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-400 italic">ç‰¹ç­†ã™ã¹ãã‚¹ã‚­ãƒ«ã‚¿ã‚°ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸãŒã€åŸºç¤èƒ½åŠ›ã¯ååˆ†ã«ã‚ã‚Šã¾ã™ã€‚</p>
          )}
        </div>

        {/* --- Gemini AI Integration Section --- */}
        <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-3xl shadow-lg p-1 border border-indigo-100 mb-8">
          <div className="bg-white/80 backdrop-blur rounded-[20px] p-8">
            <div className="flex flex-col md:flex-row items-center justify-between mb-6">
              <div>
                <h3 className="text-2xl font-bold text-gray-900 flex items-center">
                  <Bot className="w-8 h-8 text-indigo-600 mr-3" />
                  AIã‚­ãƒ£ãƒªã‚¢æˆ¦ç•¥ãƒ¬ãƒãƒ¼ãƒˆ âœ¨
                </h3>
                <p className="text-gray-600 mt-2">
                  ã‚ãªãŸã®è¨ºæ–­çµæœã¨ã‚¹ã‚­ãƒ«ã‚’AIãŒè©³ç´°ã«åˆ†æã—ã€<br className="hidden md:block"/>
                  ã‚ãªãŸã ã‘ã®ã€Œè‡ªå·±PRã€ã‚„ã€Œæ˜æ—¥ã‹ã‚‰ã®è¡Œå‹•ã€ã‚’ææ¡ˆã—ã¾ã™ã€‚
                </p>
              </div>
              {!aiReport && !isGenerating && (
                <button
                  onClick={generateAIReport}
                  className="mt-4 md:mt-0 flex items-center px-6 py-3 bg-indigo-600 text-white rounded-full font-bold shadow-md hover:bg-indigo-700 hover:shadow-lg transition-all transform hover:-translate-y-1"
                >
                  <Sparkles className="w-5 h-5 mr-2" />
                  ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹ (Free)
                </button>
              )}
            </div>

            {isGenerating && (
              <div className="flex flex-col items-center justify-center py-12">
                <Sparkles className="w-12 h-12 text-indigo-500 animate-spin mb-4" />
                <p className="text-indigo-700 font-bold animate-pulse">AIãŒã‚ãªãŸã®å¼·ã¿ã‚’åˆ†æä¸­...</p>
                <p className="text-sm text-indigo-400 mt-2">æœ€é«˜ã®è‡ªå·±PRã‚’è€ƒãˆã¦ã„ã¾ã™</p>
              </div>
            )}

            {aiReport && (
              <div className="animate-fade-in bg-white rounded-xl border border-gray-200 p-6 md:p-8 shadow-inner">
                {/* ç‹¬è‡ªãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã§è¡¨ç¤º */}
                <SimpleMarkdown text={aiReport} />
                
                <div className="mt-6 pt-6 border-t border-gray-100 text-center">
                  <p className="text-xs text-gray-400">â€» AIã«ã‚ˆã‚‹ç”Ÿæˆçµæœã§ã™ã€‚å†…å®¹ã‚’å‚è€ƒã«ã€ã”è‡ªèº«ã®è¨€è‘‰ã§ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
              </div>
            )}
          </div>
        </div>

        {/* å›ç­”ãƒ­ã‚° */}
        <div className="mt-8 text-center pb-8">
          <button
            onClick={() => {
              const text = history.map(h => `Q: ${h.q}\nA: ${h.a}`).join('\n\n');
              navigator.clipboard.writeText(text);
              alert('å›ç­”ãƒ­ã‚°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            }}
            className="text-indigo-600 font-bold hover:underline mb-8"
          >
            å›ç­”ãƒ­ã‚°ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ï¼ˆãƒ¡ãƒ¢ç”¨ï¼‰
          </button>
          
          <div>
            <button
              onClick={startDiagnosis}
              className="inline-flex items-center px-8 py-4 bg-gray-900 text-white rounded-full font-bold shadow-lg hover:bg-gray-800 transition-all"
            >
              <RefreshCcw className="w-5 h-5 mr-2" />
              ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹
            </button>
          </div>
        </div>

      </div>
    );
  };

  const renderAnalyzing = () => (
    <div className="flex flex-col items-center justify-center min-h-[60vh] animate-pulse">
      <div className="relative">
        <Sparkles className="w-20 h-20 text-indigo-300" />
        <div className="absolute top-0 left-0 w-full h-full flex items-center justify-center">
          <RefreshCcw className="w-8 h-8 text-indigo-600 animate-spin" />
        </div>
      </div>
      <h2 className="text-3xl font-bold text-gray-800 mt-8">å¤šè§’çš„ã«åˆ†æä¸­...</h2>
      <p className="text-gray-500 mt-4 text-lg">ã‚ãªãŸã®å›ç­”ã‹ã‚‰ã€æœ€é©ãªã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹ã‚’æã„ã¦ã„ã¾ã™</p>
    </div>
  );

  return (
    <div className="min-h-screen bg-gray-50 font-sans text-gray-900 selection:bg-indigo-100">
      <header className="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div className="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center space-x-2 cursor-pointer" onClick={() => setScreen('welcome')}>
            <div className="bg-indigo-600 p-1.5 rounded text-white">
              <Heart size={18} fill="currentColor" />
            </div>
            <span className="font-bold text-lg tracking-tight text-gray-800">Self-Discovery Compass Pro</span>
          </div>
        </div>
      </header>

      <main className="max-w-5xl mx-auto px-4 py-8 md:py-12">
        {screen === 'welcome' && renderWelcome()}
        {screen === 'question' && renderQuestion()}
        {screen === 'analyzing' && renderAnalyzing()}
        {screen === 'result' && renderResult()}
      </main>

      <style>{`
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slide-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 0.6s ease-out forwards; }
        .animate-slide-up { animation: slide-up 0.4s ease-out forwards; }
      `}</style>
    </div>
  );
};

export default App;
